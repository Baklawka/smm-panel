<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>SMM Panel Pro</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --accent: #f093fb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --rahmat: #00a859;
            --dark-bg: #0a0a14;
            --card-bg: #16182e;
            --card-hover: #1a1d38;
            --card-border: #252849;
            --input-bg: #1a1d38;
            --text-primary: #ffffff;
            --text-secondary: #a0aec0;
            --text-muted: #718096;
            --nav-height: 70px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            overflow-x: hidden;
            padding-bottom: var(--nav-height);
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 30px rgba(102, 126, 234, 0.4);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .header-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent) 0%, #f5576c 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: 900;
            border: 3px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
            position: relative;
        }

        .header-avatar:active {
            transform: scale(0.95);
        }

        .header-avatar.online::after {
            content: '';
            position: absolute;
            bottom: 2px;
            right: 2px;
            width: 12px;
            height: 12px;
            background: var(--success);
            border: 2px solid var(--primary);
            border-radius: 50%;
        }

        .header-info {
            display: flex;
            flex-direction: column;
        }

        .header-name {
            font-size: 15px;
            font-weight: 800;
            line-height: 1.2;
        }

        .header-status {
            font-size: 11px;
            opacity: 0.85;
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            gap: 8px;
        }

        .header-btn {
            width: 44px;
            height: 44px;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            border-radius: 12px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .header-btn:active {
            transform: scale(0.95);
        }

        .header-btn.admin-toggle {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border: none;
            box-shadow: 0 4px 15px rgba(240, 147, 251, 0.4);
        }

        .mode-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 16px;
            height: 16px;
            background: #ef4444;
            border-radius: 50%;
            font-size: 9px;
            font-weight: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--primary);
        }

        /* Container */
        .container {
            padding: 16px;
            max-width: 600px;
            margin: 0 auto;
            min-height: calc(100vh - 150px);
        }

        /* Views */
        .view {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .view.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Balance Card */
        .balance-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            padding: 24px;
            border-radius: 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .balance-card::before {
            content: '';
            position: absolute;
            top: -50px;
            right: -50px;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .balance-label {
            font-size: 12px;
            opacity: 0.9;
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            z-index: 1;
        }

        .balance-amount {
            font-size: 40px;
            font-weight: 900;
            margin-bottom: 16px;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
            position: relative;
            z-index: 1;
            display: flex;
            align-items: baseline;
            gap: 8px;
        }

        .currency {
            font-size: 20px;
            opacity: 0.8;
            font-weight: 700;
        }

        .balance-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            position: relative;
            z-index: 1;
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .action-btn {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            padding: 16px 8px;
            border-radius: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.4s, height 0.4s;
        }

        .action-btn:hover::before {
            width: 200px;
            height: 200px;
        }

        .action-icon {
            font-size: 28px;
            margin-bottom: 8px;
            display: block;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        .action-label {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        /* Profile Card */
        .profile-card {
            background: linear-gradient(135deg, var(--card-bg) 0%, #1a1f3a 100%);
            border: 1px solid var(--card-border);
            padding: 24px;
            border-radius: 20px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .profile-card::before {
            content: '';
            position: absolute;
            top: -100px;
            right: -100px;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.15) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
            position: relative;
            z-index: 1;
        }

        .profile-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: 900;
            border: 3px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
        }

        .profile-details {
            flex: 1;
        }

        .profile-name {
            font-size: 20px;
            font-weight: 900;
            margin-bottom: 4px;
        }

        .profile-id {
            font-size: 12px;
            color: var(--text-secondary);
            font-family: monospace;
            background: rgba(255,255,255,0.05);
            padding: 4px 8px;
            border-radius: 6px;
            display: inline-block;
            margin-bottom: 8px;
        }

        .profile-join-date {
            font-size: 11px;
            color: var(--text-muted);
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            position: relative;
            z-index: 1;
            margin-bottom: 16px;
        }

        .stat-item {
            text-align: center;
            padding: 16px 12px;
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            background: rgba(255,255,255,0.05);
            border-color: var(--primary);
        }

        .stat-value {
            font-size: 22px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 10px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .profile-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            position: relative;
            z-index: 1;
        }

        /* Referral Card */
        .referral-card {
            background: linear-gradient(135deg, var(--rahmat) 0%, #00c96d 100%);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 8px 24px rgba(0, 168, 89, 0.3);
        }

        .referral-card::before {
            content: 'üí∞';
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 100px;
            opacity: 0.1;
        }

        .referral-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .referral-desc {
            font-size: 12px;
            opacity: 0.9;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
        }

        .referral-code {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
        }

        .referral-link {
            font-family: monospace;
            font-size: 12px;
            font-weight: 700;
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .copy-btn {
            background: rgba(255,255,255,0.3);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .copy-btn:active {
            transform: scale(0.95);
        }

        .referral-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            position: relative;
            z-index: 1;
        }

        .referral-stat {
            background: rgba(255,255,255,0.15);
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
        }

        .referral-stat-value {
            font-size: 18px;
            font-weight: 900;
            margin-bottom: 2px;
        }

        .referral-stat-label {
            font-size: 10px;
            opacity: 0.9;
        }

        /* Section */
        .section {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 16px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .see-all {
            font-size: 12px;
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .see-all:hover {
            color: var(--secondary);
        }

        /* Order Card */
        .order-card {
            background: var(--input-bg);
            border: 1px solid var(--card-border);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .order-card:hover {
            background: var(--card-hover);
            border-color: var(--primary);
            transform: translateX(4px);
        }

        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .order-id {
            font-size: 11px;
            color: var(--text-secondary);
            font-family: monospace;
        }

        .order-service {
            font-weight: 700;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .order-details {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .order-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .order-price {
            font-size: 16px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Service Card */
        .service-card {
            background: var(--input-bg);
            border: 2px solid var(--card-border);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.5s;
        }

        .service-card:hover::before {
            left: 100%;
        }

        .service-card:active {
            transform: scale(0.98);
        }

        .service-card.selected {
            border-color: var(--primary);
            background: rgba(102, 126, 234, 0.1);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }

        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 8px;
        }

        .service-name {
            font-weight: 700;
            font-size: 14px;
            flex: 1;
        }

        .service-badge {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 700;
        }

        .service-desc {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .service-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .service-price {
            font-size: 18px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .service-limits {
            font-size: 10px;
            color: var(--text-muted);
        }

        /* Transaction Card */
        .transaction-card {
            background: var(--input-bg);
            border: 1px solid var(--card-border);
            padding: 12px 16px;
            border-radius: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .transaction-card:hover {
            background: var(--card-hover);
        }

        .transaction-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .transaction-icon.income {
            background: rgba(16, 185, 129, 0.15);
        }

        .transaction-icon.expense {
            background: rgba(239, 68, 68, 0.15);
        }

        .transaction-info {
            display: flex;
            flex-direction: column;
        }

        .transaction-title {
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .transaction-date {
            font-size: 11px;
            color: var(--text-muted);
        }

        .transaction-amount {
            font-size: 15px;
            font-weight: 900;
        }

        .transaction-amount.income {
            color: var(--success);
        }

        .transaction-amount.expense {
            color: var(--danger);
        }

        /* Button */
        .btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border: none;
            color: var(--text-primary);
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .btn-white {
            background: rgba(255,255,255,0.95);
            color: var(--primary);
            box-shadow: 0 4px 15px rgba(255,255,255,0.2);
        }

        .btn-rahmat {
            background: linear-gradient(135deg, var(--rahmat) 0%, #00c96d 100%);
            box-shadow: 0 4px 15px rgba(0, 168, 89, 0.3);
        }

        .btn-secondary {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            box-shadow: none;
        }

        .btn-sm {
            padding: 10px 16px;
            font-size: 12px;
            width: auto;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        /* Form */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 12px;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            background: var(--input-bg);
            border: 2px solid var(--card-border);
            color: var(--text-primary);
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Payment Methods */
        .payment-methods {
            display: grid;
            gap: 12px;
        }

        .payment-method {
            background: var(--input-bg);
            border: 2px solid var(--card-border);
            padding: 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .payment-method:hover {
            border-color: var(--primary);
        }

        .payment-method.selected {
            border-color: var(--rahmat);
            background: rgba(0, 168, 89, 0.1);
        }

        .payment-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: var(--rahmat);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .payment-info {
            flex: 1;
        }

        .payment-name {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .payment-desc {
            font-size: 11px;
            color: var(--text-muted);
        }

        .payment-check {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid var(--card-border);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .payment-method.selected .payment-check {
            border-color: var(--rahmat);
            background: var(--rahmat);
        }

        .payment-method.selected .payment-check::after {
            content: '‚úì';
            color: white;
            font-size: 14px;
            font-weight: 900;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge.success { background: rgba(16, 185, 129, 0.15); color: var(--success); }
        .badge.warning { background: rgba(245, 158, 11, 0.15); color: var(--warning); }
        .badge.danger { background: rgba(239, 68, 68, 0.15); color: var(--danger); }
        .badge.info { background: rgba(59, 130, 246, 0.15); color: var(--info); }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--nav-height);
            background: var(--card-bg);
            border-top: 1px solid var(--card-border);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 0 8px;
            z-index: 1000;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.3);
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 12px;
            position: relative;
        }

        .nav-item:active {
            transform: scale(0.95);
        }

        .nav-item.active {
            background: rgba(102, 126, 234, 0.1);
        }

        .nav-icon {
            font-size: 24px;
            transition: all 0.3s ease;
        }

        .nav-item.active .nav-icon {
            transform: translateY(-2px);
            filter: drop-shadow(0 4px 8px rgba(102, 126, 234, 0.5));
        }

        .nav-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .nav-item.active .nav-label {
            color: var(--primary);
            font-weight: 700;
        }

        .nav-indicator {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 0 0 3px 3px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .nav-item.active .nav-indicator {
            opacity: 1;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 20, 0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.2s ease;
            overflow-y: auto;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            padding: 24px;
            max-width: 90%;
            width: 440px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 800;
        }

        .close-btn {
            width: 36px;
            height: 36px;
            background: var(--input-bg);
            border: none;
            border-radius: 50%;
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .close-btn:active {
            transform: scale(0.9);
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 80px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            padding: 16px 20px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            z-index: 9999;
            min-width: 280px;
            max-width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            opacity: 0;
            transition: all 0.3s ease;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.info { border-left: 4px solid var(--info); }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.3;
            animation: float 3s ease-in-out infinite;
        }

        .empty-text {
            font-size: 14px;
            font-weight: 600;
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--card-border);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(10, 10, 20, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            backdrop-filter: blur(4px);
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--card-border);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            overflow-x: auto;
            padding-bottom: 8px;
            -webkit-overflow-scrolling: touch;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab-btn {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            color: var(--text-secondary);
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--text-primary);
            border-color: transparent;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Admin Stats */
        .admin-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .admin-stat-card {
            background: var(--card-bg);
            border: 1px solid var(--card-border);
            padding: 20px;
            border-radius: 16px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .admin-stat-card:hover {
            border-color: var(--primary);
        }

        .admin-stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .admin-stat-icon {
            font-size: 32px;
            margin-bottom: 12px;
        }

        .admin-stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .admin-stat-value {
            font-size: 28px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Table */
        .table-wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: -10px;
            padding: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid var(--card-border);
        }

        th {
            font-size: 10px;
            color: var(--text-secondary);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: rgba(255,255,255,0.02);
        }

        td {
            font-size: 13px;
        }

        tr:hover {
            background: rgba(255,255,255,0.02);
        }

        /* Responsive */
        @media (max-width: 640px) {
            .quick-actions {
                grid-template-columns: repeat(4, 1fr);
            }

            .admin-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left" onclick="showView('profile')">
            <div class="header-avatar online" id="headerAvatar">üë§</div>
            <div class="header-info">
                <div class="header-name" id="headerName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div class="header-status" id="headerStatus">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
            </div>
        </div>
        <div class="header-actions">
            <button class="header-btn admin-toggle" id="adminToggle" style="display: none;" onclick="toggleAdmin()">
                üéõÔ∏è
                <span class="mode-badge" id="modeBadge">A</span>
            </button>
            <button class="header-btn admin-toggle" style="display: none;" onclick="toggleAdmin()">üîÑ</button>
        </div>
    </div>

    <div class="container">
        <!-- HOME VIEW --->
        <div class="view active" id="homeView">
            <div class="balance-card">
                <div class="balance-label">üí∞ –í–∞—à –±–∞–ª–∞–Ω—Å</div>
                <div class="balance-amount">
                    <span id="homeBalance">0</span>
                    <span class="currency">UZS</span>
                </div>
                <div class="balance-actions">
                    <button class="btn btn-white" onclick="showModal('topupModal')">
                        üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å
                    </button>
                    <button class="btn btn-white" onclick="showModal('promoModal')">
                        üéÅ –ü—Ä–æ–º–æ–∫–æ–¥
                    </button>
                </div>
            </div>

            <div class="quick-actions">
                <div class="action-btn" onclick="showView('services')">
                    <span class="action-icon">üõçÔ∏è</span>
                    <span class="action-label">–£—Å–ª—É–≥–∏</span>
                </div>
                <div class="action-btn" onclick="showView('orders')">
                    <span class="action-icon">üì¶</span>
                    <span class="action-label">–ó–∞–∫–∞–∑—ã</span>
                </div>
                <div class="action-btn" onclick="showView('profile')">
                    <span class="action-icon">üë§</span>
                    <span class="action-label">–ü—Ä–æ—Ñ–∏–ª—å</span>
                </div>
                <div class="action-btn" onclick="showModal('supportModal')">
                    <span class="action-icon">üí¨</span>
                    <span class="action-label">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</span>
                </div>
            </div>

            <div class="section">
                <div class="section-header">
                    <div class="section-title">üì¶ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</div>
                    <div class="see-all" onclick="showView('orders')">–í—Å–µ ‚Üí</div>
                </div>
                <div id="recentOrders">
                    <div class="empty-state">
                        <div class="empty-icon">üì¶</div>
                        <div class="empty-text">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SERVICES VIEW -->
        <div class="view" id="servicesView">
            <div class="section">
                <div class="form-group">
                    <label class="form-label">üéØ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</label>
                    <select class="form-select" id="platformSelect" onchange="loadCategories()">
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É...</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">üìÅ –ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select class="form-select" id="categorySelect" onchange="loadServices()">
                        <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É</option>
                    </select>
                </div>
            </div>

            <div id="servicesList"></div>

            <div class="section" id="orderForm" style="display: none;">
                <div class="section-title">üìù –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</div>
                <form onsubmit="createOrder(event)">
                    <div class="form-group">
                        <label class="form-label">üîó –°—Å—ã–ª–∫–∞</label>
                        <input type="url" class="form-input" id="orderLink" placeholder="https://instagram.com/p/xxx" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">üî¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                        <input type="number" class="form-input" id="orderQty" min="100" oninput="calcTotal()" required>
                        <small id="qtyLimits" style="color: var(--text-muted); font-size: 11px; display: block; margin-top: 8px;"></small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">üí∞ –ö –æ–ø–ª–∞—Ç–µ</label>
                        <div style="font-size: 32px; font-weight: 900; background: linear-gradient(135deg, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; display: flex; align-items: baseline; gap: 8px;">
                            <span id="orderTotal">0</span>
                            <span style="font-size: 18px;">UZS</span>
                        </div>
                    </div>
                    <button type="submit" class="btn">‚úÖ –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>
                </form>
            </div>
        </div>

        <!-- ORDERS VIEW -->
        <div class="view" id="ordersView">
            <div class="tabs">
                <button class="tab-btn active" onclick="filterOrders('all', event)">–í—Å–µ</button>
                <button class="tab-btn" onclick="filterOrders('pending', event)">–û–∂–∏–¥–∞—é—Ç</button>
                <button class="tab-btn" onclick="filterOrders('processing', event)">–í —Ä–∞–±–æ—Ç–µ</button>
                <button class="tab-btn" onclick="filterOrders('completed', event)">–ì–æ—Ç–æ–≤—ã–µ</button>
            </div>

            <div id="ordersContainer">
                <div class="empty-state">
                    <div class="empty-icon">üì¶</div>
                    <div class="empty-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                </div>
            </div>
        </div>

        <!-- PROFILE VIEW -->
        <div class="view" id="profileView">
            <div class="profile-card">
                <div class="profile-header">
                    <div class="profile-avatar-large" id="profileAvatar">üë§</div>
                    <div class="profile-details">
                        <div class="profile-name" id="profileName">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        <div class="profile-id">ID: <span id="profileId">0</span></div>
                        <div class="profile-join-date" id="profileJoinDate">–° –Ω–∞–º–∏ —Å —Å–µ–≥–æ–¥–Ω—è</div>
                    </div>
                </div>
                <div class="profile-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="profileOrders">0</div>
                        <div class="stat-label">–ó–∞–∫–∞–∑–æ–≤</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="profileSpent">0</div>
                        <div class="stat-label">–ü–æ—Ç—Ä–∞—á–µ–Ω–æ</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="profileBalance">0</div>
                        <div class="stat-label">–ë–∞–ª–∞–Ω—Å</div>
                    </div>
                </div>
                <div class="profile-actions">
                    <button class="btn" onclick="showModal('topupModal')">üí≥ –ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
                    <button class="btn btn-secondary" onclick="showModal('settingsModal')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                </div>
            </div>

            <div class="referral-card">
                <div class="referral-title">üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</div>
                <div class="referral-desc">–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π—Ç–µ 10% –æ—Ç –∏—Ö –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–π!</div>
                <div class="referral-code">
                    <span class="referral-link" id="refLink">t.me/yourbot?start=ref123</span>
                    <button class="copy-btn" onclick="copyRefLink()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                </div>
                <div class="referral-stats">
                    <div class="referral-stat">
                        <div class="referral-stat-value" id="refInvited">0</div>
                        <div class="referral-stat-label">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ</div>
                    </div>
                    <div class="referral-stat">
                        <div class="referral-stat-value" id="refEarned">0</div>
                        <div class="referral-stat-label">–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ UZS</div>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">üí≥ –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div>
                <div id="transactionsList">
                    <div class="empty-state">
                        <div class="empty-icon">üí≥</div>
                        <div class="empty-text">–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ADMIN VIEW -->
        <div class="view" id="adminView">
            <div class="admin-stats">
                <div class="admin-stat-card">
                    <div class="admin-stat-icon">üë•</div>
                    <div class="admin-stat-label">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
                    <div class="admin-stat-value" id="adminUsers">0</div>
                </div>
                <div class="admin-stat-card">
                    <div class="admin-stat-icon">üì¶</div>
                    <div class="admin-stat-label">–ó–∞–∫–∞–∑—ã</div>
                    <div class="admin-stat-value" id="adminOrders">0</div>
                </div>
                <div class="admin-stat-card">
                    <div class="admin-stat-icon">üí∞</div>
                    <div class="admin-stat-label">–î–æ—Ö–æ–¥ (UZS)</div>
                    <div class="admin-stat-value" id="adminRevenue">0</div>
                </div>
                <div class="admin-stat-card">
                    <div class="admin-stat-icon">‚è≥</div>
                    <div class="admin-stat-label">–ê–∫—Ç–∏–≤–Ω—ã–µ</div>
                    <div class="admin-stat-value" id="adminActive">0</div>
                </div>
            </div>

            <div class="tabs">
                <button class="tab-btn active" data-tab="adminServices">üìã –£—Å–ª—É–≥–∏</button>
                <button class="tab-btn" data-tab="adminUsers">üë• –Æ–∑–µ—Ä—ã</button>
                <button class="tab-btn" data-tab="adminOrders">üì¶ –ó–∞–∫–∞–∑—ã</button>
                <button class="tab-btn" data-tab="adminPromo">üéÅ –ü—Ä–æ–º–æ</button>
                <button class="tab-btn" data-tab="adminSettings">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            </div>

            <div class="tab-content active" id="adminServicesContent">
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∞–º–∏</div>
                        <button class="btn btn-sm" onclick="showModal('addServiceModal')">+ –î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                    <div id="adminServicesList">
                        <div class="empty-state">
                            <div class="empty-icon">‚è≥</div>
                            <div class="empty-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="adminUsersContent">
                <div class="section">
                    <div class="section-title">üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                                    <th>–ë–∞–ª–∞–Ω—Å</th>
                                    <th>–ó–∞–∫–∞–∑–æ–≤</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="adminUsersTable">
                                <tr><td colspan="4" style="text-align: center;">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="adminOrdersContent">
                <div class="section">
                    <div class="section-title">üì¶ –í—Å–µ –∑–∞–∫–∞–∑—ã</div>
                    <div id="adminOrdersList">
                        <div class="empty-state">
                            <div class="empty-icon">‚è≥</div>
                            <div class="empty-text">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="adminPromoContent">
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥—ã</div>
                        <button class="btn btn-sm" onclick="showModal('addPromoModal')">+ –°–æ–∑–¥–∞—Ç—å</button>
                    </div>
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>–ö–æ–¥</th>
                                    <th>–ë–æ–Ω—É—Å (UZS)</th>
                                    <th>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody id="adminPromoTable">
                                <tr><td colspan="4" style="text-align: center;">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="adminSettingsContent">
                <div class="section">
                    <div class="section-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</div>
                    <form onsubmit="saveAdminSettings(event)">
                        <div class="form-group">
                            <label class="form-label">–ú–∏–Ω. —Å—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (UZS)</label>
                            <input type="number" class="form-input" id="minTopupAmount" value="10000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">–ú–∞–∫—Å. —Å—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (UZS)</label>
                            <input type="number" class="form-input" id="maxTopupAmount" value="10000000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">SMM API –∫–ª—é—á</label>
                            <input type="text" class="form-input" id="smmApiKey" placeholder="–≤–∞—à_api_–∫–ª—é—á">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Rahmat Merchant ID</label>
                            <input type="text" class="form-input" id="rahmatMerchant" placeholder="merchant_id">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Rahmat Secret Key</label>
                            <input type="password" class="form-input" id="rahmatSecret" placeholder="secret_key">
                        </div>
                        <button type="submit" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="showView('home')">
            <div class="nav-indicator"></div>
            <div class="nav-icon">üè†</div>
            <div class="nav-label">–ì–ª–∞–≤–Ω–∞—è</div>
        </div>
        <div class="nav-item" onclick="showView('services')">
            <div class="nav-indicator"></div>
            <div class="nav-icon">üõçÔ∏è</div>
            <div class="nav-label">–£—Å–ª—É–≥–∏</div>
        </div>
        <div class="nav-item" onclick="showView('orders')">
            <div class="nav-indicator"></div>
            <div class="nav-icon">üì¶</div>
            <div class="nav-label">–ó–∞–∫–∞–∑—ã</div>
        </div>
        <div class="nav-item" onclick="showView('profile')">
            <div class="nav-indicator"></div>
            <div class="nav-icon">üë§</div>
            <div class="nav-label">–ü—Ä–æ—Ñ–∏–ª—å</div>
        </div>
    </div>

    <!-- Modals -->

    <!-- Topup Modal with Rahmat -->
    <div class="modal" id="topupModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üí≥ –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞</div>
                <button class="close-btn" onclick="closeModal('topupModal')">√ó</button>
            </div>

            <div class="form-group">
                <label class="form-label">–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (UZS)</label>
                <input type="number" class="form-input" id="topupAmount" min="10000" max="10000000" placeholder="50000" value="50000" oninput="updateTopupPreview()">
                <small style="color: var(--text-muted); font-size: 11px; display: block; margin-top: 8px;">
                    –ú–∏–Ω–∏–º—É–º: 10,000 UZS ‚Ä¢ –ú–∞–∫—Å–∏–º—É–º: 10,000,000 UZS
                </small>
            </div>

            <div class="form-group">
                <label class="form-label">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</label>
                <div class="payment-methods">
                    <div class="payment-method selected" data-method="rahmat">
                        <div class="payment-icon">üí≥</div>
                        <div class="payment-info">
                            <div class="payment-name">Rahmat</div>
                            <div class="payment-desc">–û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π —á–µ—Ä–µ–∑ Rahmat</div>
                        </div>
                        <div class="payment-check"></div>
                    </div>
                    <!-- –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã -->
                </div>
            </div>

            <div class="form-group">
                <div style="background: rgba(0, 168, 89, 0.1); border: 1px solid rgba(0, 168, 89, 0.3); padding: 16px; border-radius: 12px;">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">–ö –æ–ø–ª–∞—Ç–µ:</div>
                    <div style="font-size: 32px; font-weight: 900; color: var(--rahmat); display: flex; align-items: baseline; gap: 8px;">
                        <span id="topupPreview">50,000</span>
                        <span style="font-size: 18px;">UZS</span>
                    </div>
                </div>
            </div>

            <button class="btn btn-rahmat" onclick="processRahmatTopup()">
                üí≥ –û–ø–ª–∞—Ç–∏—Ç—å —á–µ—Ä–µ–∑ Rahmat
            </button>
        </div>
    </div>

    <!-- Promo Modal -->
    <div class="modal" id="promoModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üéÅ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</div>
                <button class="close-btn" onclick="closeModal('promoModal')">√ó</button>
            </div>
            <form onsubmit="applyPromo(event)">
                <div class="form-group">
                    <label class="form-label">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥</label>
                    <input type="text" class="form-input" id="promoCode" placeholder="WELCOME2024" style="text-transform:uppercase" required>
                </div>
                <button type="submit" class="btn">‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
            </form>
        </div>
    </div>

    <!-- Support Modal -->
    <div class="modal" id="supportModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞</div>
                <button class="close-btn" onclick="closeModal('supportModal')">√ó</button>
            </div>
            <div style="text-align: center; padding: 20px 0;">
                <div style="font-size: 64px; margin-bottom: 16px;">üí¨</div>
                <div style="font-size: 16px; font-weight: 700; margin-bottom: 8px;">
                    –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?
                </div>
                <div style="font-size: 14px; color: var(--text-secondary); margin-bottom: 20px;">
                    –ù–∞—à–∞ –∫–æ–º–∞–Ω–¥–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≥–æ—Ç–æ–≤–∞ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã 24/7
                </div>
                <button class="btn" onclick="window.open('https://t.me/support', '_blank')">
                    üì± –ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</div>
                <button class="close-btn" onclick="closeModal('settingsModal')">√ó</button>
            </div>
            <div style="padding: 20px 0; text-align: center;">
                <div style="font-size: 48px; margin-bottom: 16px;">‚öôÔ∏è</div>
                <div style="font-size: 14px; color: var(--text-secondary);">
                    –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
                </div>
            </div>
        </div>
    </div>

    <!-- Add Service Modal -->
    <div class="modal" id="addServiceModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">‚ûï –ù–æ–≤–∞—è —É—Å–ª—É–≥–∞</div>
                <button class="close-btn" onclick="closeModal('addServiceModal')">√ó</button>
            </div>
            <form onsubmit="createService(event)">
                <div class="form-group">
                    <label class="form-label">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞</label>
                    <select class="form-select" id="adminPlatform" onchange="loadAdminCategories()" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select class="form-select" id="adminCategory" required>
                        <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" class="form-input" id="serviceName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea class="form-textarea" id="serviceDesc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —É—Å–ª—É–≥–∏..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">–¶–µ–Ω–∞ –∑–∞ 1000 (UZS)</label>
                    <input type="number" class="form-input" id="servicePrice" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–∫–∞–∑</label>
                    <input type="number" class="form-input" id="serviceMin" value="100" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –∑–∞–∫–∞–∑</label>
                    <input type="number" class="form-input" id="serviceMax" value="100000" required>
                </div>
                <button type="submit" class="btn">‚úÖ –°–æ–∑–¥–∞—Ç—å —É—Å–ª—É–≥—É</button>
            </form>
        </div>
    </div>

    <!-- Add Promo Modal -->
    <div class="modal" id="addPromoModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üéÅ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</div>
                <button class="close-btn" onclick="closeModal('addPromoModal')">√ó</button>
            </div>
            <form onsubmit="createPromo(event)">
                <div class="form-group">
                    <label class="form-label">–ö–æ–¥ –ø—Ä–æ–º–æ–∫–æ–¥–∞</label>
                    <input type="text" class="form-input" id="newPromoCode" placeholder="BONUS100" style="text-transform:uppercase" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–ë–æ–Ω—É—Å (UZS)</label>
                    <input type="number" class="form-input" id="promoBonus" placeholder="50000" required>
                </div>
                <div class="form-group">
                    <label class="form-label">–ú–∞–∫—Å–∏–º—É–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π</label>
                    <input type="number" class="form-input" id="promoMaxUses" value="100" required>
                </div>
                <button type="submit" class="btn">‚úÖ –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥</button>
            </form>
        </div>
    </div>

    <div class="loading-overlay" id="globalLoading">
        <div class="spinner"></div>
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        // ============= CONFIG =============
        const API_URL = 'http://localhost:8000/api';

        let tg = window.Telegram?.WebApp;
        let authToken = '';
        let isAdmin = false;
        let currentView = 'home';
        let selectedService = null;
        let userData = {};
        let allOrders = [];

        if (tg) {
            tg.expand();
            tg.ready();
            tg.setHeaderColor('#667eea');
            authToken = tg.initData;
        } else {
            authToken = 'debug_mode';
        }

        // ============= UTILS =============
        function fmt(num) {
            if (!num) return '0';
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        async function api(endpoint, method = 'GET', data = null) {
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': authToken || ''
                }
            };

            if (data) options.body = JSON.stringify(data);

            try {
                const res = await fetch(API_URL + endpoint, options);
                const json = await res.json();

                if (!res.ok) throw new Error(json.detail || 'API Error');

                return json;
            } catch (err) {
                toast(err.message, 'error');
                throw err;
            }
        }

        function toast(msg, type = 'info') {
            const el = document.createElement('div');
            el.className = `toast ${type}`;
            el.textContent = msg;
            document.body.appendChild(el);

            setTimeout(() => el.classList.add('show'), 100);
            setTimeout(() => {
                el.classList.remove('show');
                setTimeout(() => el.remove(), 300);
            }, 3000);
        }

        function showModal(id) {
            document.getElementById(id).classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function showLoading() {
            document.getElementById('globalLoading').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('globalLoading').classList.remove('active');
        }

        // ============= VIEW MANAGEMENT =============
        function showView(viewName) {
            // Hide all views
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));

            // Show selected view
            const viewMap = {
                'home': 'homeView',
                'services': 'servicesView',
                'orders': 'ordersView',
                'profile': 'profileView',
                'admin': 'adminView'
            };

            const viewId = viewMap[viewName];
            if (viewId) {
                document.getElementById(viewId).classList.add('active');
            }

            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            const navItems = document.querySelectorAll('.nav-item');
            const navMap = ['home', 'services', 'orders', 'profile'];
            const index = navMap.indexOf(viewName);
            if (index >= 0) navItems[index].classList.add('active');

            // Load data
            if (viewName === 'home') loadHome();
            else if (viewName === 'services') loadServicesView();
            else if (viewName === 'orders') loadOrders();
            else if (viewName === 'profile') loadProfile();
            else if (viewName === 'admin') loadAdmin();

            currentView = viewName;
        }

        function toggleAdmin() {
            if (!isAdmin) {
                toast('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω', 'error');
                return;
            }

            if (currentView === 'admin') {
                showView('home');
                document.getElementById('modeBadge').textContent = 'A';
                toast('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º', 'info');
            } else {
                showView('admin');
                document.getElementById('modeBadge').textContent = 'U';
                toast('–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞', 'info');
            }
        }

        // ============= INIT =============
        async function init() {
            try {
                showLoading();

                const userInfo = await api('/user/info');
                userData = userInfo;
                isAdmin = userInfo.is_admin;

                // Update header
                const initials = userInfo.first_name.charAt(0).toUpperCase();
                document.getElementById('headerAvatar').textContent = initials;
                document.getElementById('headerName').textContent = userInfo.first_name;
                document.getElementById('headerStatus').textContent = isAdmin ? '‚≠ê –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : 'üíé –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';

                if (isAdmin) {
                    document.getElementById('adminToggle').style.display = 'flex';
                }

                await loadHome();
                setupEvents();

                hideLoading();
                toast(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${userInfo.first_name}! üëã`, 'success');
            } catch (err) {
                hideLoading();
                toast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }

        function setupEvents() {
            // Admin tabs
            document.querySelectorAll('[data-tab]').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tab = this.getAttribute('data-tab');
                    switchAdminTab(tab);
                });
            });

            // Payment methods
            document.querySelectorAll('.payment-method').forEach(method => {
                method.addEventListener('click', function() {
                    document.querySelectorAll('.payment-method').forEach(m => m.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });

            // Close modals on backdrop click
            document.addEventListener('click', e => {
                if (e.target.classList.contains('modal')) {
                    e.target.classList.remove('active');
                }
            });
        }

        function switchAdminTab(tabName) {
            document.querySelectorAll('[data-tab]').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + 'Content').classList.add('active');

            if (tabName === 'adminServices') loadAdminServices();
            else if (tabName === 'adminUsers') loadAdminUsers();
            else if (tabName === 'adminOrders') loadAdminOrders();
            else if (tabName === 'adminPromo') loadAdminPromo();
        }

        // ============= HOME =============
        async function loadHome() {
            try {
                const balance = await api('/user/balance');
                document.getElementById('homeBalance').textContent = fmt(balance.balance);

                const orders = await api('/orders');
                allOrders = orders;

                const recentOrders = orders.slice(0, 3);

                if (recentOrders.length > 0) {
                    document.getElementById('recentOrders').innerHTML = recentOrders.map(o => `
                        <div class="order-card">
                            <div class="order-header">
                                <span class="order-id">${o.order_id}</span>
                                <span class="badge ${statusClass(o.status)}">${statusText(o.status)}</span>
                            </div>
                            <div class="order-service">${o.service_name}</div>
                            <div class="order-details">${fmt(o.quantity)} —à—Ç.</div>
                            <div class="order-footer">
                                <span class="order-price">${fmt(o.total_price)} UZS</span>
                                <small style="color: var(--text-muted); font-size: 10px;">${formatDate(o.created_at)}</small>
                            </div>
                        </div>
                    `).join('');
                } else {
                    document.getElementById('recentOrders').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">üì¶</div>
                            <div class="empty-text">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div>
                        </div>
                    `;
                }

                await loadPlatforms();
            } catch (err) {
                console.error('Failed to load home:', err);
            }
        }

        // ============= SERVICES =============
        async function loadServicesView() {
            await loadPlatforms();
        }

        async function loadPlatforms() {
            try {
                const platforms = await api('/platforms');
                const select = document.getElementById('platformSelect');
                const adminSelect = document.getElementById('adminPlatform');

                const options = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É...</option>' +
                    platforms.map(p => `<option value="${p.id}">${p.icon} ${p.name}</option>`).join('');

                select.innerHTML = options;
                if (adminSelect) adminSelect.innerHTML = options;
            } catch (err) {
                console.error('Failed to load platforms:', err);
            }
        }

        async function loadCategories() {
            const platformId = document.getElementById('platformSelect').value;
            const catSelect = document.getElementById('categorySelect');

            if (!platformId) {
                catSelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É</option>';
                document.getElementById('servicesList').innerHTML = '';
                document.getElementById('orderForm').style.display = 'none';
                return;
            }

            try {
                const categories = await api(`/categories/${platformId}`);
                catSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é...</option>' +
                    categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
                document.getElementById('servicesList').innerHTML = '';
                document.getElementById('orderForm').style.display = 'none';
            } catch (err) {
                console.error('Failed to load categories:', err);
            }
        }

        async function loadServices() {
            const catId = document.getElementById('categorySelect').value;
            const list = document.getElementById('servicesList');

            if (!catId) {
                list.innerHTML = '';
                document.getElementById('orderForm').style.display = 'none';
                return;
            }

            try {
                const services = await api(`/services/${catId}`);

                if (services.length === 0) {
                    list.innerHTML = '<div class="empty-state"><div class="empty-icon">üõçÔ∏è</div><div class="empty-text">–ù–µ—Ç —É—Å–ª—É–≥</div></div>';
                    return;
                }

                list.innerHTML = services.map(s => `
                    <div class="service-card" onclick='selectService(${JSON.stringify(s).replace(/'/g, "&apos;")})'>
                        <div class="service-header">
                            <div class="service-name">${s.name}</div>
                            <div class="service-badge">‚ö° –ë—ã—Å—Ç—Ä–æ</div>
                        </div>
                        <div class="service-desc">${s.description || '–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –Ω–∞–∫—Ä—É—Ç–∫–∞ –±–µ–∑ —Å–ø–∏—Å–∞–Ω–∏–π'}</div>
                        <div class="service-footer">
                            <div class="service-price">${fmt(s.price_per_k)} UZS/1K</div>
                            <div class="service-limits">–ú–∏–Ω: ${fmt(s.min_order)}</div>
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                console.error('Failed to load services:', err);
            }
        }

        function selectService(service) {
            selectedService = service;

            document.querySelectorAll('.service-card').forEach(c => c.classList.remove('selected'));
            event.currentTarget.classList.add('selected');

            document.getElementById('orderForm').style.display = 'block';
            document.getElementById('qtyLimits').textContent = `–ú–∏–Ω: ${fmt(service.min_order)} ‚Ä¢ –ú–∞–∫—Å: ${fmt(service.max_order)}`;
            document.getElementById('orderQty').min = service.min_order;
            document.getElementById('orderQty').max = service.max_order;
            document.getElementById('orderQty').value = service.min_order;

            calcTotal();

            // Scroll to form
            document.getElementById('orderForm').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function calcTotal() {
            if (!selectedService) return;

            const qty = parseInt(document.getElementById('orderQty').value) || 0;
            const total = Math.ceil((qty / 1000) * selectedService.price_per_k);
            document.getElementById('orderTotal').textContent = fmt(total);
        }

        async function createOrder(e) {
            e.preventDefault();
            if (!selectedService) return;

            const orderData = {
                service_id: selectedService.id,
                link: document.getElementById('orderLink').value.trim(),
                quantity: parseInt(document.getElementById('orderQty').value)
            };

            try {
                showLoading();
                const result = await api('/orders', 'POST', orderData);
                hideLoading();

                toast(`‚úÖ –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω! ${result.order_id}`, 'success');

                // Reset form
                document.getElementById('orderLink').value = '';
                document.getElementById('orderQty').value = '';
                document.getElementById('orderForm').style.display = 'none';
                selectedService = null;

                // Update balance
                document.getElementById('homeBalance').textContent = fmt(result.new_balance);

                // Go to orders
                setTimeout(() => showView('orders'), 1000);
            } catch (err) {
                hideLoading();
            }
        }

        // ============= ORDERS =============
        async function loadOrders(filter = 'all') {
            try {
                if (allOrders.length === 0) {
                    allOrders = await api('/orders');
                }

                const container = document.getElementById('ordersContainer');

                let filtered = allOrders;
                if (filter !== 'all') {
                    filtered = allOrders.filter(o => o.status === filter);
                }

                if (filtered.length === 0) {
                    container.innerHTML = '<div class="empty-state"><div class="empty-icon">üì¶</div><div class="empty-text">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div></div>';
                    return;
                }

                container.innerHTML = filtered.map(o => `
                    <div class="order-card">
                        <div class="order-header">
                            <span class="order-id">${o.order_id}</span>
                            <span class="badge ${statusClass(o.status)}">${statusText(o.status)}</span>
                        </div>
                        <div class="order-service">${o.service_name}</div>
                        <div class="order-details">${o.service_detail || ''} ‚Ä¢ ${fmt(o.quantity)} —à—Ç.</div>
                        <div class="order-footer">
                            <span class="order-price">${fmt(o.total_price)} UZS</span>
                            <small style="color: var(--text-muted); font-size: 10px;">${formatDate(o.created_at)}</small>
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                console.error('Failed to load orders:', err);
            }
        }

        function filterOrders(status, event) {
            document.querySelectorAll('#ordersView .tab-btn').forEach(btn => btn.classList.remove('active'));
            if (event) event.currentTarget.classList.add('active');
            loadOrders(status);
        }

        // ============= PROFILE =============
        async function loadProfile() {
            try {
                const balance = await api('/user/balance');
                const orders = allOrders.length > 0 ? allOrders : await api('/orders');

                const initials = userData.first_name.charAt(0).toUpperCase();
                document.getElementById('profileAvatar').textContent = initials;
                document.getElementById('profileName').textContent = userData.first_name || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                document.getElementById('profileId').textContent = userData.telegram_id;

                // Join date
                const joinDate = userData.created_at ? new Date(userData.created_at) : new Date();
                document.getElementById('profileJoinDate').textContent = `–° –Ω–∞–º–∏ —Å ${formatDate(joinDate)}`;

                // Stats
                document.getElementById('profileOrders').textContent = orders.length;

                const totalSpent = orders.reduce((sum, o) => sum + (o.total_price || 0), 0);
                document.getElementById('profileSpent').textContent = fmt(totalSpent);
                document.getElementById('profileBalance').textContent = fmt(balance.balance);

                // Referral
                const refLink = `https://t.me/yourbot?start=ref${userData.telegram_id}`;
                document.getElementById('refLink').textContent = refLink;

                // Referral stats (mock for now)
                document.getElementById('refInvited').textContent = userData.referrals_count || 0;
                document.getElementById('refEarned').textContent = fmt(userData.referral_earnings || 0);

                // Transactions (mock for now)
                loadTransactions();
            } catch (err) {
                console.error('Failed to load profile:', err);
            }
        }

        function loadTransactions() {
            // Mock transactions
            const transactions = [
                { id: 1, type: 'income', title: '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Rahmat', amount: 50000, date: new Date() },
                { id: 2, type: 'expense', title: '–ó–∞–∫–∞–∑ #12345', amount: -15000, date: new Date() }
            ];

            const list = document.getElementById('transactionsList');

            if (transactions.length === 0) {
                list.innerHTML = '<div class="empty-state"><div class="empty-icon">üí≥</div><div class="empty-text">–ù–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</div></div>';
                return;
            }

            list.innerHTML = transactions.map(t => `
                <div class="transaction-card">
                    <div class="transaction-left">
                        <div class="transaction-icon ${t.type}">
                            ${t.type === 'income' ? 'üí∞' : 'üì¶'}
                        </div>
                        <div class="transaction-info">
                            <div class="transaction-title">${t.title}</div>
                            <div class="transaction-date">${formatDate(t.date)}</div>
                        </div>
                    </div>
                    <div class="transaction-amount ${t.type}">
                        ${t.amount > 0 ? '+' : ''}${fmt(Math.abs(t.amount))} UZS
                    </div>
                </div>
            `).join('');
        }

        function copyRefLink() {
            const link = document.getElementById('refLink').textContent;

            if (navigator.clipboard) {
                navigator.clipboard.writeText(link);
                toast('üìã –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
            } else {
                // Fallback
                const input = document.createElement('input');
                input.value = link;
                document.body.appendChild(input);
                input.select();
                document.execCommand('copy');
                document.body.removeChild(input);
                toast('üìã –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!', 'success');
            }
        }

        // ============= TOPUP & PROMO =============
        function updateTopupPreview() {
            const amount = parseInt(document.getElementById('topupAmount').value) || 0;
            document.getElementById('topupPreview').textContent = fmt(amount);
        }

        async function processRahmatTopup() {
            const amount = parseInt(document.getElementById('topupAmount').value);

            if (!amount || amount < 10000) {
                toast('–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: 10,000 UZS', 'error');
                return;
            }

            if (amount > 10000000) {
                toast('–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞: 10,000,000 UZS', 'error');
                return;
            }

            try {
                showLoading();

                // Create payment
                const payment = await api('/payment/rahmat/create', 'POST', { amount });

                hideLoading();
                closeModal('topupModal');

                // Open Rahmat payment page
                if (payment.payment_url) {
                    window.open(payment.payment_url, '_blank');
                    toast('–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ–ø–ª–∞—Ç—É...', 'info');
                } else {
                    toast('‚úÖ –ü–ª–∞—Ç—ë–∂ —Å–æ–∑–¥–∞–Ω! ID: ' + payment.payment_id, 'success');
                }
            } catch (err) {
                hideLoading();
                toast('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞', 'error');
            }
        }

        async function applyPromo(e) {
            e.preventDefault();
            const code = document.getElementById('promoCode').value.toUpperCase().trim();

            if (!code) {
                toast('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥', 'error');
                return;
            }

            try {
                showLoading();
                const result = await api(`/promo/apply?code=${code}`, 'POST');
                hideLoading();

                toast(`üéÅ –ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! +${fmt(result.bonus)} UZS`, 'success');
                closeModal('promoModal');

                // Update balance
                document.getElementById('homeBalance').textContent = fmt(result.new_balance);
                document.getElementById('profileBalance').textContent = fmt(result.new_balance);

                document.getElementById('promoCode').value = '';
            } catch (err) {
                hideLoading();
            }
        }

        // ============= ADMIN =============
        async function loadAdmin() {
            try {
                const stats = await api('/admin/stats');
                document.getElementById('adminUsers').textContent = fmt(stats.total_users);
                document.getElementById('adminOrders').textContent = fmt(stats.total_orders);
                document.getElementById('adminRevenue').textContent = fmt(stats.total_revenue);
                document.getElementById('adminActive').textContent = fmt(stats.pending_orders);

                await loadAdminServices();
            } catch (err) {
                console.error('Failed to load admin:', err);
            }
        }

        async function loadAdminServices() {
            try {
                const services = await api('/admin/services');
                const list = document.getElementById('adminServicesList');

                if (services.length === 0) {
                    list.innerHTML = '<div class="empty-state"><div class="empty-icon">üìã</div><div class="empty-text">–ù–µ—Ç —É—Å–ª—É–≥</div></div>';
                    return;
                }

                list.innerHTML = services.map(s => `
                    <div class="service-card">
                        <div class="service-header">
                            <div class="service-name">
                                <small style="color: var(--text-muted);">${s.platform_name} ‚Ä¢ ${s.category_name}</small><br>
                                <strong>${s.name}</strong>
                            </div>
                            <span class="badge ${s.is_active ? 'success' : 'danger'}">${s.is_active ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–í—ã–∫–ª'}</span>
                        </div>
                        <div class="service-footer">
                            <div class="service-price">${fmt(s.price_per_k)} UZS/1K</div>
                            <button class="btn btn-sm btn-danger" onclick="deleteService(${s.id})">üóëÔ∏è</button>
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                console.error('Failed to load admin services:', err);
            }
        }

        async function loadAdminUsers() {
            try {
                const data = await api('/admin/users');
                const tbody = document.getElementById('adminUsersTable');

                if (data.users.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">–ù–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</td></tr>';
                    return;
                }

                tbody.innerHTML = data.users.map(u => `
                    <tr>
                        <td>
                            <strong>${u.first_name}</strong><br>
                            <small style="color: var(--text-muted);">@${u.username || 'none'}</small>
                        </td>
                        <td>${fmt(u.balance)} UZS</td>
                        <td>${u.orders_count || 0}</td>
                        <td>
                            <button class="btn btn-sm ${u.is_blocked ? 'btn-secondary' : 'btn-danger'}" onclick="blockUser(${u.telegram_id}, ${!u.is_blocked})">
                                ${u.is_blocked ? '‚úÖ –†–∞–∑–±–ª–æ–∫.' : 'üö´ –ë–ª–æ–∫'}
                            </button>
                        </td>
                    </tr>
                `).join('');
            } catch (err) {
                console.error('Failed to load users:', err);
            }
        }

        async function loadAdminOrders() {
            try {
                const orders = await api('/admin/orders');
                const list = document.getElementById('adminOrdersList');

                if (orders.length === 0) {
                    list.innerHTML = '<div class="empty-state"><div class="empty-icon">üì¶</div><div class="empty-text">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</div></div>';
                    return;
                }

                list.innerHTML = orders.slice(0, 50).map(o => `
                    <div class="order-card">
                        <div class="order-header">
                            <span class="order-id">${o.order_id}</span>
                            <span class="badge ${statusClass(o.status)}">${statusText(o.status)}</span>
                        </div>
                        <div class="order-details">
                            <strong>@${o.username || o.user_id}</strong> ‚Ä¢ ${o.service_name}
                        </div>
                        <div class="order-footer">
                            <span class="order-price">${fmt(o.total_price)} UZS</span>
                            <small style="color: var(--text-muted); font-size: 10px;">${formatDate(o.created_at)}</small>
                        </div>
                    </div>
                `).join('');
            } catch (err) {
                console.error('Failed to load admin orders:', err);
            }
        }

        async function loadAdminPromo() {
            try {
                const promos = await api('/admin/promocodes');
                const tbody = document.getElementById('adminPromoTable');

                if (promos.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">–ù–µ—Ç –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤</td></tr>';
                    return;
                }

                tbody.innerHTML = promos.map(p => `
                    <tr>
                        <td><strong>${p.code}</strong></td>
                        <td>${fmt(p.bonus_amount || 0)}</td>
                        <td>${p.used_count}/${p.max_uses}</td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="deletePromo('${p.code}')">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');
            } catch (err) {
                console.error('Failed to load promo:', err);
            }
        }

        async function loadAdminCategories() {
            const platformId = document.getElementById('adminPlatform').value;
            const catSelect = document.getElementById('adminCategory');

            if (!platformId) {
                catSelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É</option>';
                return;
            }

            try {
                const categories = await api(`/categories/${platformId}`);
                catSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é...</option>' +
                    categories.map(c => `<option value="${c.id}">${c.name}</option>`).join('');
            } catch (err) {
                console.error('Failed to load admin categories:', err);
            }
        }

        async function createService(e) {
            e.preventDefault();

            const data = {
                category_id: parseInt(document.getElementById('adminCategory').value),
                name: document.getElementById('serviceName').value.trim(),
                description: document.getElementById('serviceDesc').value.trim(),
                price_per_k: parseInt(document.getElementById('servicePrice').value),
                min_order: parseInt(document.getElementById('serviceMin').value),
                max_order: parseInt(document.getElementById('serviceMax').value)
            };

            try {
                showLoading();
                await api('/admin/services', 'POST', data);
                hideLoading();

                toast('‚úÖ –£—Å–ª—É–≥–∞ —Å–æ–∑–¥–∞–Ω–∞!', 'success');
                closeModal('addServiceModal');

                // Reset form
                document.getElementById('serviceName').value = '';
                document.getElementById('serviceDesc').value = '';
                document.getElementById('servicePrice').value = '';

                loadAdminServices();
            } catch (err) {
                hideLoading();
            }
        }

        async function deleteService(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —É—Å–ª—É–≥—É?')) return;

            try {
                showLoading();
                await api(`/admin/services/${id}`, 'DELETE');
                hideLoading();

                toast('–£—Å–ª—É–≥–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
                loadAdminServices();
            } catch (err) {
                hideLoading();
            }
        }

        async function blockUser(id, block) {
            try {
                showLoading();
                await api(`/admin/users/${id}/block`, 'PUT', {is_blocked: block});
                hideLoading();

                toast(block ? '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω', 'success');
                loadAdminUsers();
            } catch (err) {
                hideLoading();
            }
        }

        async function createPromo(e) {
            e.preventDefault();

            const data = {
                code: document.getElementById('newPromoCode').value.toUpperCase().trim(),
                bonus_amount: parseInt(document.getElementById('promoBonus').value),
                max_uses: parseInt(document.getElementById('promoMaxUses').value),
                expires_at: null
            };

            try {
                showLoading();
                await api('/admin/promocodes', 'POST', data);
                hideLoading();

                toast('üéÅ –ü—Ä–æ–º–æ–∫–æ–¥ —Å–æ–∑–¥–∞–Ω!', 'success');
                closeModal('addPromoModal');

                // Reset form
                document.getElementById('newPromoCode').value = '';
                document.getElementById('promoBonus').value = '';

                loadAdminPromo();
            } catch (err) {
                hideLoading();
            }
        }

        async function deletePromo(code) {
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ ${code}?`)) return;

            try {
                showLoading();
                await api(`/admin/promocodes/${code}`, 'DELETE');
                hideLoading();

                toast('–ü—Ä–æ–º–æ–∫–æ–¥ —É–¥–∞–ª—ë–Ω', 'success');
                loadAdminPromo();
            } catch (err) {
                hideLoading();
            }
        }

        async function saveAdminSettings(e) {
            e.preventDefault();
            toast('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏', 'info');
        }

        // ============= HELPERS =============
        function statusClass(status) {
            return {
                'completed': 'success',
                'processing': 'warning',
                'pending': 'info',
                'cancelled': 'danger'
            }[status] || 'info';
        }

        function statusText(status) {
            return {
                'pending': '‚è≥ –û–∂–∏–¥–∞–µ—Ç',
                'processing': 'üîÑ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è',
                'completed': '‚úÖ –ì–æ—Ç–æ–≤–æ',
                'cancelled': '‚ùå –û—Ç–º–µ–Ω—ë–Ω'
            }[status] || status;
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diff = now - date;

            // Less than 1 minute
            if (diff < 60000) return '–¢–æ–ª—å–∫–æ —á—Ç–æ';

            // Less than 1 hour
            if (diff < 3600000) {
                const mins = Math.floor(diff / 60000);
                return `${mins} –º–∏–Ω. –Ω–∞–∑–∞–¥`;
            }

            // Less than 24 hours
            if (diff < 86400000) {
                const hours = Math.floor(diff / 3600000);
                return `${hours} —á. –Ω–∞–∑–∞–¥`;
            }

            // Default
            return date.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit', year: 'numeric' });
        }

        function refreshData() {
            if (currentView === 'home') loadHome();
            else if (currentView === 'services') loadServicesView();
            else if (currentView === 'orders') { allOrders = []; loadOrders(); }
            else if (currentView === 'profile') loadProfile();
            else if (currentView === 'admin') loadAdmin();

            toast('–û–±–Ω–æ–≤–ª–µ–Ω–æ ‚úÖ', 'success');
        }

        // ============= START =============
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>



